<!DOCTYPE html>
<html>
<head>
    <title>ç½‘é¡µæ²™ç›˜ç¨‹åº</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        #toolbar {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255,255,255,0.8);
            padding: 10px;
            border-radius: 5px;
        }
        .tool-btn {
            width: 40px;
            height: 40px;
            margin: 5px;
            cursor: pointer;
        }
        #context-menu {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            display: none;
        }
        .context-menu-item {
            padding: 8px 15px;
            cursor: pointer;
        }
        .context-menu-item:hover {
            background: #f0f0f0;
        }
    </style>
</head>
<body>
    <div id="toolbar">
        <button class="tool-btn" data-type="circle">â—‹</button>
        <button class="tool-btn" data-type="square">â–¡</button>
        <button class="tool-btn" data-type="line">ï¼</button>
        <button id="save-btn" class="tool-btn">ğŸ’¾</button>
        <button id="load-btn" class="tool-btn">ğŸ“‚</button>
    </div>

    <div id="context-menu">
        <div class="context-menu-item" id="delete-item">åˆ é™¤</div>
        <div class="context-menu-item" id="clone-item">å…‹éš†</div>
    </div>

    <canvas id="sandbox"></canvas>

    <script>
        const canvas = document.getElementById('sandbox');
        const ctx = canvas.getContext('2d');
        
        // è®¾ç½®ç”»å¸ƒå°ºå¯¸
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // çŠ¶æ€ç®¡ç†
        let currentType = 'square';
        let elements = [];
        let selectedElement = null;
        let isDragging = false;
        let startX, startY;

        // å…ƒç´ ç±»å‹é…ç½®
        const elementConfig = {
            circle: { color: '#FF6B6B', size: 40 },
            square: { color: '#4ECDC4', size: 50 },
            line: { color: '#45B7D1', size: 60 }
        };

        // å·¥å…·æŒ‰é’®äº‹ä»¶
        document.querySelectorAll('.tool-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                if (this.dataset.type) {
                    currentType = this.dataset.type;
                } else if (this.id === 'save-btn') {
                    saveState();
                } else if (this.id === 'load-btn') {
                    loadState();
                }
            });
        });

        // ç»˜åˆ¶åŠŸèƒ½
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            elements.forEach(el => {
                ctx.fillStyle = el.color;
                if (el.type === 'square') {
                    ctx.fillRect(el.x, el.y, el.size, el.size);
                } else if (el.type === 'circle') {
                    ctx.beginPath();
                    ctx.arc(el.x + el.size/2, el.y + el.size/2, el.size/2, 0, Math.PI * 2);
                    ctx.fill();
                } else if (el.type === 'line') {
                    ctx.beginPath();
                    ctx.moveTo(el.x, el.y);
                    ctx.lineTo(el.x + el.size, el.y + el.size);
                    ctx.strokeStyle = el.color;
                    ctx.lineWidth = 4;
                    ctx.stroke();
                }
            });
        }

        // äº‹ä»¶å¤„ç†
        canvas.addEventListener('mousedown', startDrag);
        canvas.addEventListener('mousemove', drag);
        canvas.addEventListener('mouseup', endDrag);
        canvas.addEventListener('contextmenu', showContextMenu);

        function startDrag(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            selectedElement = elements.find(el => {
                return x > el.x && x < el.x + el.size &&
                       y > el.y && y < el.y + el.size;
            });

            if (selectedElement) {
                isDragging = true;
                startX = x - selectedElement.x;
                startY = y - selectedElement.y;
            } else if (e.button === 0) {
                elements.push({
                    type: currentType,
                    x: x - elementConfig[currentType].size/2,
                    y: y - elementConfig[currentType].size/2,
                    size: elementConfig[currentType].size,
                    color: elementConfig[currentType].color
                });
                draw();
            }
        }

        function drag(e) {
            if (!isDragging) return;
            const rect = canvas.getBoundingClientRect();
            selectedElement.x = e.clientX - rect.left - startX;
            selectedElement.y = e.clientY - rect.top - startY;
            draw();
        }
        function endDrag() {
            isDragging = false;
            selectedElement = null;
        }

        // å³é”®èœå•å¤„ç†
        function showContextMenu(e) {
            e.preventDefault();
            const menu = document.getElementById('context-menu');
            const rect = canvas.getBoundingClientRect();
            
            // æ£€æµ‹ç‚¹å‡»å…ƒç´ 
            selectedElement = elements.find(el => {
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                return x > el.x && x < el.x + el.size &&
                       y > el.y && y < el.y + el.size;
            });

            if (selectedElement) {
                menu.style.display = 'block';
                menu.style.left = e.clientX + 'px';
                menu.style.top = e.clientY + 'px';
            }
        }

        // å³é”®èœå•æ“ä½œ
        document.getElementById('delete-item').addEventListener('click', () => {
            if (selectedElement) {
                elements = elements.filter(el => el !== selectedElement);
                draw();
            }
            hideContextMenu();
        });

        document.getElementById('clone-item').addEventListener('click', () => {
            if (selectedElement) {
                elements.push({
                    ...selectedElement,
                    x: selectedElement.x + 20,
                    y: selectedElement.y + 20
                });
                draw();
            }
            hideContextMenu();
        });

        // éšè—å³é”®èœå•
        document.addEventListener('click', hideContextMenu);
        function hideContextMenu() {
            document.getElementById('context-menu').style.display = 'none';
        }

        // çŠ¶æ€å­˜å‚¨åŠŸèƒ½
        function saveState() {
            const data = {
                elements: elements,
                canvasSize: { width: canvas.width, height: canvas.height }
            };
            localStorage.setItem('sandbox-state', JSON.stringify(data));
            alert('çŠ¶æ€å·²ä¿å­˜');
        }

        function loadState() {
            const data = JSON.parse(localStorage.getItem('sandbox-state'));
            if (data) {
                elements = data.elements;
                canvas.width = data.canvasSize.width;
                canvas.height = data.canvasSize.height;
                draw();
                alert('çŠ¶æ€å·²åŠ è½½');
            } else {
                alert('æ‰¾ä¸åˆ°ä¿å­˜è®°å½•');
            }
        }

        // åˆå§‹ç»˜åˆ¶
        draw();
    </script>
</body>
</html>

       
